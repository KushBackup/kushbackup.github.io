<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Titan Arcade - Premium Experience</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

    <!-- Google Fonts: Premium Luxury Tech -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- GLOBAL VARIABLES --- */
        :root {
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --neon-blue: #2997ff;
            --neon-purple: #bf5af2;
            --neon-green: #30d158;
            --neon-gold: #ffd60a;
            --bg-dark: #050507;
        }

        body {
            background-color: #020202;
            background-image: radial-gradient(circle at 50% 0%, #1a1a2e 0%, #000 100%);
            color: #f5f5f7;
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .font-display { font-family: 'Outfit', sans-serif; letter-spacing: -0.02em; }

        /* --- APP CONTAINER (Mobile Frame on Desktop) --- */
        #app-frame {
            width: 100%;
            height: 100%;
            max-width: 420px;
            max-height: 850px;
            background-color: #000;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        @media (min-width: 450px) {
            #app-frame {
                border-radius: 40px;
                border: 8px solid #1a1a1a;
            }
        }

        /* --- SCREEN MANAGEMENT --- */
        .screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            background: #050507;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 0;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .screen.active {
            opacity: 1;
            pointer-events: all;
            z-index: 10;
        }

        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- BACKGROUND STYLES --- */
        .bg-mesh-purple {
            background: 
                radial-gradient(at 0% 0%, rgba(88, 28, 135, 0.4) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(124, 58, 237, 0.2) 0px, transparent 50%),
                #050507;
        }
        .bg-mesh-blue {
            background: 
                radial-gradient(at 100% 0%, rgba(37, 99, 235, 0.3) 0px, transparent 50%),
                radial-gradient(at 0% 100%, rgba(29, 78, 216, 0.2) 0px, transparent 50%),
                #050507;
        }
        .bg-mesh-gold {
            background: 
                radial-gradient(at 50% 0%, rgba(234, 179, 8, 0.15) 0px, transparent 60%),
                #050507;
        }
        .bg-mesh-dark {
            background-color: #080808;
            background-image: radial-gradient(circle at 50% 0%, #1a1a1a 0%, #000 100%);
        }

        /* --- UI COMPONENTS --- */
        .header-glass {
            position: fixed;
            top: 0; left: 0; width: 100%;
            padding: 16px 20px;
            padding-top: max(16px, env(safe-area-inset-top));
            display: flex; justify-content: space-between; align-items: center;
            z-index: 50;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
            pointer-events: none; /* Let clicks pass through transparent parts */
        }
        .header-glass > * { pointer-events: auto; }

        .resource-pill {
            display: flex; align-items: center; gap: 6px; padding: 4px 10px;
            background: rgba(255,255,255,0.08); border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(10px);
        }

        .footer-nav {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 80px;
            background: rgba(10, 10, 10, 0.85); backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-around; align-items: center;
            padding-bottom: 20px; z-index: 50;
        }

        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: #6b7280; font-size: 10px; font-weight: 600; transition: all 0.3s;
            cursor: pointer;
        }
        .nav-item.active { color: white; transform: translateY(-2px); }
        .nav-item.active i { color: var(--neon-blue); text-shadow: 0 0 10px rgba(41,151,255,0.5); }
        .nav-item i { font-size: 18px; margin-bottom: 2px; }

        /* Flashlight Effect */
        .flashlight-card {
            position: relative; background: var(--glass-bg);
            border: 1px solid var(--glass-border); border-radius: 24px; overflow: hidden;
            transition: all 0.3s ease;
        }
        .flashlight-card:active { transform: scale(0.98); }
        .flashlight-card::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(400px circle at var(--mouse-x) var(--mouse-y), rgba(255,255,255,0.06), transparent 40%);
            z-index: 1; opacity: 0; transition: opacity 0.5s; pointer-events: none;
        }
        .flashlight-card:hover::before { opacity: 1; }
        .flashlight-card:hover { border-color: rgba(255,255,255,0.2); }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #2997ff 0%, #007aff 100%);
            color: white; font-family: 'Outfit', sans-serif; font-weight: 700;
            text-transform: uppercase; letter-spacing: 1px; border-radius: 16px;
            box-shadow: 0 4px 20px rgba(41, 151, 255, 0.4); transition: all 0.2s;
            position: relative; overflow: hidden;
        }
        .btn-primary:active { transform: scale(0.96); }
        
        /* Beam Animation */
        .beam-btn {
            position: relative; background: rgba(255,255,255,0.05);
            border-radius: 9999px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.2s;
        }
        .beam-btn::after {
            content: ''; position: absolute; inset: 0; padding: 1px; border-radius: 9999px;
            background: linear-gradient(90deg, transparent 50%, rgba(255,255,255,0.8), transparent 100%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude; -webkit-mask-composite: xor;
            background-size: 200% 100%; animation: beam 2s linear infinite;
        }
        @keyframes beam { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }

        /* Animations */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeUp { animation: fadeUp 0.6s ease-out forwards; }
        
        .clip-char { transform: translateY(-100%); opacity: 0; animation: slideDown 0.6s cubic-bezier(0.16,1,0.3,1) forwards; display: inline-block; }
        @keyframes slideDown { to { transform: translateY(0); opacity: 1; } }

        /* Game Specific */
        #game-canvas-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; opacity: 0; pointer-events: none;
        }
        #game-canvas-container.active { opacity: 1; pointer-events: all; }

        /* Carousel */
        .carousel-track { display: flex; transition: transform 0.5s ease; height: 100%; }
        .carousel-slide { min-width: 100%; height: 100%; position: relative; }
    </style>
</head>
<body>

<div id="app-frame">

    <!-- ==================== SCREEN 0: BRAND REVEAL ==================== -->
    <div id="screen-splash" class="screen active justify-center items-center bg-black" onclick="app.showScreen('screen-landing')">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(41,151,255,0.15)_0%,transparent_60%)]"></div>
        <div class="relative z-10 flex flex-col items-center animate-fadeUp">
            <div class="w-24 h-24 rounded-3xl bg-gradient-to-br from-[#1a1a1a] to-black border border-white/10 flex items-center justify-center mb-6 shadow-2xl">
                <i class="fa-solid fa-gamepad text-5xl text-transparent bg-clip-text bg-gradient-to-br from-blue-400 to-purple-400 drop-shadow-[0_0_15px_rgba(41,151,255,0.5)]"></i>
            </div>
            <h1 class="text-4xl font-display font-black tracking-[0.2em] text-white" id="brand-text">TITAN</h1>
            <p class="text-xs text-blue-400 font-bold tracking-[0.5em] mt-2 uppercase">Arcade</p>
        </div>
        <div class="absolute bottom-10 text-gray-600 text-[10px] animate-pulse">Tap to Start</div>
    </div>

    <!-- ==================== SCREEN 1: LANDING ==================== -->
    <div id="screen-landing" class="screen bg-mesh-purple justify-end p-6">
        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1614726365723-49cfae9f9110?q=80&w=600')] bg-cover opacity-40 mix-blend-overlay"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div>
        
        <div class="relative z-10 mb-10 animate-fadeUp">
            <h1 class="text-5xl font-display font-bold text-white leading-tight mb-4">Play.<br>Win.<br>Earn.</h1>
            <p class="text-gray-300 text-sm mb-8 leading-relaxed">The premier esports arcade. Compete in skill-based minigames and win real rewards.</p>
            <button class="btn-primary w-full py-4 text-sm shadow-lg shadow-blue-500/30" onclick="app.completeLanding()">Get Started</button>
            <p class="text-[10px] text-center text-gray-500 mt-4">By continuing, you agree to our Terms.</p>
        </div>
    </div>

    <!-- ==================== SCREEN 1.5: TUTORIAL ==================== -->
    <div id="screen-tutorial" class="screen bg-black justify-center items-center p-6 text-center">
        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5980?q=80&w=400')] bg-cover opacity-20"></div>
        <div class="relative z-10 w-full max-w-sm">
            <div class="w-20 h-20 rounded-full bg-white/10 border border-white/20 flex items-center justify-center mx-auto mb-6 backdrop-blur-md">
                <i class="fa-regular fa-hand-pointer text-3xl text-white animate-bounce"></i>
            </div>
            <h2 class="text-3xl font-display font-bold text-white mb-3">Drag to Move</h2>
            <p class="text-gray-400 text-sm mb-8 px-4 leading-relaxed">Precision is key. Your ship fires automatically. Focus on dodging debris.</p>
            <button class="beam-btn w-full py-4 text-white font-bold text-xs uppercase" onclick="app.finishTutorial()">Complete Training</button>
        </div>
    </div>

    <!-- ==================== SCREEN 2: HUB ==================== -->
    <div id="screen-hub" class="screen bg-mesh-blue">
        <!-- HEADER -->
        <div class="header-glass">
            <div class="flex items-center gap-2" onclick="app.showScreen('screen-profile')">
                <div class="w-9 h-9 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 p-[1.5px]">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-full h-full rounded-full bg-black">
                </div>
                <div class="flex flex-col">
                    <span class="text-[9px] text-gray-400 uppercase font-bold">Rookie</span>
                    <span class="text-xs font-bold text-white">PlayerOne</span>
                </div>
            </div>
            <div class="flex gap-2">
                <div class="resource-pill"><i class="fa-solid fa-gem text-pink-500 text-[10px]"></i><span class="text-xs font-bold" id="hub-gems">0</span></div>
                <div class="resource-pill bg-green-900/40 border-green-500/30"><i class="fa-solid fa-dollar-sign text-green-400 text-[10px]"></i><span class="text-xs font-bold text-green-400" id="hub-cash">$0.00</span></div>
            </div>
        </div>

        <div class="h-full overflow-y-auto pt-24 pb-28 px-5 no-scrollbar">
            <!-- Carousel -->
            <div class="w-full h-80 rounded-3xl relative overflow-hidden mb-6 group shadow-2xl flashlight-card p-0">
                <div class="carousel-track" id="hub-carousel">
                    <!-- Slide 1 -->
                    <div class="carousel-slide bg-[url('https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=600')] bg-cover bg-center">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>
                        <div class="absolute bottom-5 left-5 right-5">
                            <span class="bg-blue-600 text-white text-[9px] font-bold px-2 py-1 rounded-md uppercase tracking-wider mb-2 inline-block">Featured</span>
                            <h2 class="text-3xl font-display font-bold text-white mb-1">Neon Blitz</h2>
                            <div class="flex items-center justify-between">
                                <p class="text-xs text-gray-300">Space Shooter</p>
                                <button class="btn-primary px-6 py-2 text-xs font-bold" onclick="app.openMatchmaking()">PLAY</button>
                            </div>
                        </div>
                    </div>
                    <!-- Slide 2 -->
                    <div class="carousel-slide bg-[url('https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=600')] bg-cover bg-center">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>
                        <div class="absolute bottom-5 left-5 right-5">
                            <span class="bg-purple-600 text-white text-[9px] font-bold px-2 py-1 rounded-md uppercase tracking-wider mb-2 inline-block">Coming Soon</span>
                            <h2 class="text-3xl font-display font-bold text-white mb-1">Cyber Drift</h2>
                            <div class="flex items-center justify-between">
                                <p class="text-xs text-gray-300">Racing</p>
                                <button class="bg-white/10 border border-white/20 text-white px-6 py-2 rounded-xl text-xs font-bold backdrop-blur-md">NOTIFY</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- List -->
            <h3 class="text-sm font-display font-bold text-white mb-3 pl-1">All Games</h3>
            <div class="space-y-3">
                <div class="flashlight-card p-3 flex items-center gap-4 cursor-pointer" onclick="app.openMatchmaking()">
                    <div class="w-16 h-16 rounded-xl bg-gray-800 bg-[url('https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=200')] bg-cover"></div>
                    <div class="flex-1">
                        <h4 class="text-sm font-bold text-white">Neon Blitz</h4>
                        <p class="text-[10px] text-gray-400">Shooter ‚Ä¢ Skill</p>
                    </div>
                    <button class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-white"><i class="fa-solid fa-play text-xs"></i></button>
                </div>
                <div class="flashlight-card p-3 flex items-center gap-4 opacity-60">
                    <div class="w-16 h-16 rounded-xl bg-gray-800 bg-[url('https://images.unsplash.com/photo-1614726365723-49cfae9f9110?q=80&w=200')] bg-cover"></div>
                    <div class="flex-1">
                        <h4 class="text-sm font-bold text-white">Void Jump</h4>
                        <p class="text-[10px] text-gray-400">Platformer ‚Ä¢ Event</p>
                    </div>
                    <i class="fa-solid fa-lock text-gray-500 mr-2"></i>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer-nav">
            <div class="nav-item" onclick="app.showScreen('screen-leaderboard')"><i class="fa-solid fa-trophy"></i>Leagues</div>
            <div class="nav-item" onclick="app.showScreen('screen-settings')"><i class="fa-solid fa-gear"></i>Config</div>
            <div class="nav-item active"><div class="w-14 h-14 bg-blue-600 rounded-full flex items-center justify-center -mt-8 shadow-lg shadow-blue-500/30 text-white border-4 border-[#050507]"><i class="fa-solid fa-gamepad text-2xl mb-0"></i></div></div>
            <div class="nav-item" onclick="app.showScreen('screen-rewards')"><i class="fa-solid fa-gem"></i>Rewards</div>
            <div class="nav-item" onclick="app.showScreen('screen-profile')"><i class="fa-solid fa-user"></i>Profile</div>
        </div>
    </div>

    <!-- ==================== SCREEN 3: MATCHMAKING ==================== -->
    <div id="screen-matchmaking" class="screen bg-mesh-purple p-6 pt-24">
        <div class="header-glass">
            <i class="fa-solid fa-arrow-left text-white text-lg cursor-pointer" onclick="app.showScreen('screen-hub')"></i>
            <div class="resource-pill"><i class="fa-solid fa-gem text-pink-500 text-[10px]"></i><span class="text-xs font-bold" id="mm-gems">0</span></div>
        </div>

        <h2 class="text-3xl font-display font-bold text-white mb-2">Select Tier</h2>
        <p class="text-sm text-gray-400 mb-8">Higher risk, higher reward.</p>

        <div class="space-y-4">
            <!-- Practice -->
            <div class="flashlight-card h-24 bg-gradient-to-r from-gray-900 to-black flex p-0 overflow-hidden relative group cursor-pointer" onclick="app.startMatch('practice')">
                <div class="w-1.5 h-full bg-green-500"></div>
                <div class="p-4 flex-1 flex flex-col justify-center relative z-10">
                    <span class="text-[10px] text-green-400 font-bold uppercase tracking-wider mb-1">Practice</span>
                    <span class="text-xl font-bold text-white">Free Entry</span>
                    <span class="text-xs text-gray-500">No Prize</span>
                </div>
            </div>

            <!-- Rookie -->
            <div class="flashlight-card h-28 bg-gradient-to-r from-blue-900/40 to-black flex p-0 overflow-hidden relative border-blue-500/30 cursor-pointer" onclick="app.startMatch('rookie')">
                <div class="w-1.5 h-full bg-blue-500"></div>
                <div class="p-4 flex-1 flex flex-col justify-center relative z-10">
                    <span class="text-[10px] text-blue-400 font-bold uppercase tracking-wider mb-1">Rookie</span>
                    <div class="text-xl font-bold text-white flex items-center gap-2">3 <i class="fa-solid fa-gem text-sm text-pink-500"></i></div>
                    <span class="text-xs text-blue-200">Win 5 Gems</span>
                </div>
            </div>

            <!-- Pro -->
            <div class="flashlight-card h-24 bg-gradient-to-r from-purple-900/40 to-black flex p-0 overflow-hidden relative border-purple-500/30 cursor-pointer" onclick="app.startMatch('pro')">
                <div class="w-1.5 h-full bg-purple-500"></div>
                <div class="p-4 flex-1 flex flex-col justify-center relative z-10">
                    <span class="text-[10px] text-purple-400 font-bold uppercase tracking-wider mb-1">Legend</span>
                    <div class="text-xl font-bold text-white flex items-center gap-2">6 <i class="fa-solid fa-gem text-sm text-pink-500"></i></div>
                    <span class="text-xs text-purple-200">Win 10 Gems</span>
                </div>
            </div>
        </div>
        <!-- Loader -->
        <div id="match-loader" class="hidden absolute inset-0 bg-black/90 z-50 flex flex-col items-center justify-center">
            <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-6"></div>
            <div class="text-white font-bold font-display animate-pulse">FINDING OPPONENT...</div>
        </div>
    </div>

    <!-- ==================== SCREEN 4: GAME & HUD ==================== -->
    <div id="screen-game" class="screen bg-black overflow-hidden">
        <!-- Three.js Canvas Container -->
        <div id="game-canvas-container"></div>

        <!-- In-Game UI -->
        <div class="absolute top-0 left-0 w-full h-full pointer-events-none z-20 flex flex-col justify-between p-6 pt-14">
            <div class="flex justify-between items-start">
                <div class="bg-white/10 backdrop-blur-md border border-white/10 px-4 py-2 rounded-2xl shadow-lg">
                    <span class="block text-[9px] text-gray-300 font-bold uppercase tracking-wider">Score</span>
                    <span class="text-2xl font-display font-bold text-white" id="game-score">0</span>
                </div>
                <div class="w-14 h-14 rounded-full border-2 border-white/20 flex items-center justify-center backdrop-blur-md bg-white/5">
                    <span class="text-lg font-bold text-yellow-400" id="game-timer">60</span>
                </div>
            </div>
            
            <!-- Tutorial Overlay -->
            <div id="game-tutorial-overlay" class="absolute inset-0 flex flex-col items-center justify-center bg-black/70 backdrop-blur-sm pointer-events-auto transition-opacity duration-500">
                <div class="w-20 h-20 rounded-full border border-white/20 flex items-center justify-center mb-4">
                    <i class="fa-regular fa-hand-pointer text-4xl text-white animate-pulse"></i>
                </div>
                <h2 class="text-2xl font-display font-bold text-white">Drag to Move</h2>
                <button class="mt-8 btn-primary px-8 py-3 text-xs" onclick="app.startGameLoop()">START</button>
            </div>
        </div>
    </div>

    <!-- ==================== SCREEN 5: RESULTS ==================== -->
    <div id="screen-results" class="screen bg-[#080808] p-6 pt-20 justify-center">
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-1/2 bg-blue-600/20 blur-[100px] rounded-full pointer-events-none"></div>
        
        <div class="relative z-10 text-center mb-8">
            <h1 class="text-5xl font-display font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-gray-500 mb-2 drop-shadow-2xl" id="res-title">VICTORY</h1>
            <p class="text-gray-400 text-xs tracking-widest uppercase bg-white/5 inline-block px-3 py-1 rounded-full border border-white/5" id="res-subtitle">Ranked Match</p>
        </div>
        
        <div class="flashlight-card p-6 mb-6 backdrop-blur-xl bg-white/5 border border-white/10 relative overflow-hidden">
            <div class="flex justify-between items-end border-b border-white/10 pb-4 mb-4">
                <div class="text-left">
                    <div class="text-xs text-gray-500 mb-1 font-bold tracking-wider">YOUR SCORE</div>
                    <div class="text-4xl font-bold text-white tracking-tighter" id="res-score">0</div>
                </div>
                <div class="text-green-400 text-xs font-bold bg-green-500/10 border border-green-500/20 px-2 py-1 rounded">+240 XP</div>
            </div>
            <div class="grid grid-cols-3 gap-2 text-center">
                <div class="bg-black/40 rounded-lg p-2"><div class="text-[9px] text-gray-500 uppercase font-bold">Accuracy</div><div class="text-blue-400 font-bold text-lg" id="res-acc">0%</div></div>
                <div class="bg-black/40 rounded-lg p-2"><div class="text-[9px] text-gray-500 uppercase font-bold">Hits</div><div class="text-purple-400 font-bold text-lg" id="res-hits">0</div></div>
                <div class="bg-black/40 rounded-lg p-2 border border-yellow-500/20 bg-yellow-900/10"><div class="text-[9px] text-yellow-200 uppercase font-bold">Gems</div><div class="text-yellow-400 font-bold text-lg" id="res-gems">+0</div></div>
            </div>
        </div>
        
        <div class="mt-auto space-y-3 w-full">
            <button class="btn-primary w-full py-4 text-sm" onclick="app.startMatch(app.state.lastType)">PLAY AGAIN</button>
            <button class="w-full py-4 text-gray-400 font-bold text-xs hover:text-white" onclick="app.showScreen('screen-hub')">RETURN TO HUB</button>
        </div>
    </div>

    <!-- ==================== SCREEN 6: REWARDS ==================== -->
    <div id="screen-rewards" class="screen bg-mesh-dark">
        <div class="header-glass">
            <h2 class="text-lg font-display font-bold text-white">Rewards</h2>
            <div class="resource-pill bg-green-900/40 border-green-500/30"><span class="text-xs font-bold text-green-400" id="rew-cash">$0.00</span></div>
        </div>

        <div class="h-full overflow-y-auto pt-24 pb-28 px-5 no-scrollbar">
            <!-- Double Deposit -->
            <div class="flashlight-card p-0 h-32 relative overflow-hidden mb-4 bg-gradient-to-r from-green-900 to-emerald-950 border-green-500/20">
                <div class="relative z-10 p-5 flex flex-col justify-center h-full">
                    <h3 class="text-white font-display font-bold text-lg leading-tight">Double Your<br>Deposit</h3>
                    <button class="mt-3 bg-green-500 text-black text-[10px] font-bold px-4 py-2 rounded-full w-max">DEPOSIT NOW</button>
                </div>
                <div class="absolute right-4 top-1/2 -translate-y-1/2 text-6xl font-black text-green-400 opacity-20 italic">2X</div>
            </div>

            <!-- Daily Actions -->
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="flashlight-card p-4 bg-[#111]" onclick="app.watchAd()">
                    <p class="text-[10px] text-gray-400">Watch Ad</p>
                    <h4 class="text-sm font-bold text-white mb-2">+5 Gems</h4>
                    <i class="fa-solid fa-video text-2xl text-blue-500"></i>
                </div>
                <div class="flashlight-card p-4 bg-[#111]" onclick="alert('Missions coming soon!')">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold text-white">Daily Ops</span>
                        <span class="text-[10px] text-green-400 font-bold">$1.00</span>
                    </div>
                    <div class="w-full bg-gray-800 h-1.5 rounded-full mb-2"><div class="w-1/2 h-full bg-blue-500 rounded-full"></div></div>
                </div>
            </div>

            <!-- Gift -->
            <div class="flashlight-card p-0 h-40 bg-gradient-to-br from-gray-900 to-black relative overflow-hidden mb-4 border border-yellow-500/20" onclick="app.claimGift()">
                <div class="absolute -left-6 top-4 text-[100px] leading-none opacity-50">üéÅ</div>
                <div class="absolute right-5 top-5 text-right">
                    <div class="text-[10px] text-gray-400">Daily Gift</div>
                    <div class="text-3xl font-display font-bold text-white">Free</div>
                    <div class="text-[10px] text-yellow-400 font-bold" id="gift-status">Tap to Claim</div>
                </div>
            </div>
        </div>
        
        <!-- Footer replicated for context -->
        <div class="footer-nav">
            <div class="nav-item" onclick="app.showScreen('screen-leaderboard')"><i class="fa-solid fa-trophy"></i>Leagues</div>
            <div class="nav-item" onclick="app.showScreen('screen-settings')"><i class="fa-solid fa-gear"></i>Config</div>
            <div class="nav-item"><div class="w-12 h-12 bg-gray-800 border border-white/10 rounded-full flex items-center justify-center -mt-6 text-gray-400"><i class="fa-solid fa-gamepad text-xl mb-0"></i></div></div>
            <div class="nav-item active"><i class="fa-solid fa-gem"></i>Rewards</div>
            <div class="nav-item" onclick="app.showScreen('screen-profile')"><i class="fa-solid fa-user"></i>Profile</div>
        </div>
    </div>

    <!-- ==================== SCREEN 7: LEADERBOARD ==================== -->
    <div id="screen-leaderboard" class="screen bg-mesh-gold">
        <div class="header-glass">
            <h2 class="text-lg font-display font-bold text-white">Global Elite</h2>
            <div class="resource-pill bg-yellow-900/40 border-yellow-500/30"><span class="text-[10px] text-yellow-400 font-bold uppercase">S4</span></div>
        </div>
        <div class="pt-24 px-5 pb-28 h-full overflow-y-auto no-scrollbar">
            <div class="flex justify-center items-end gap-3 mb-8">
                <div class="flex flex-col items-center">
                    <div class="w-10 h-10 rounded-full bg-gray-700 border border-gray-500 mb-1"></div>
                    <div class="text-[10px] font-bold text-gray-400">#2 Neon</div>
                    <div class="h-16 w-12 bg-white/5 rounded-t-lg border-t border-white/10"></div>
                </div>
                <div class="flex flex-col items-center">
                    <i class="fa-solid fa-crown text-yellow-400 text-lg mb-1 drop-shadow-lg"></i>
                    <div class="w-14 h-14 rounded-full bg-gray-700 border-2 border-yellow-400 mb-1 shadow-[0_0_15px_rgba(255,215,0,0.4)]"></div>
                    <div class="text-[10px] font-bold text-white">#1 Cyber</div>
                    <div class="h-24 w-16 bg-gradient-to-b from-yellow-900/40 to-black rounded-t-lg border-t border-yellow-500/30"></div>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-10 h-10 rounded-full bg-gray-700 border border-orange-700 mb-1"></div>
                    <div class="text-[10px] font-bold text-gray-400">#3 Pixel</div>
                    <div class="h-12 w-12 bg-white/5 rounded-t-lg border-t border-white/10"></div>
                </div>
            </div>
            <div class="bg-white/5 p-3 rounded-xl border border-white/5 space-y-2">
                <div class="flex items-center p-2 rounded-lg bg-white/5"><span class="w-6 text-gray-400 font-bold">4</span><span class="flex-1 text-white text-sm">VoidWalker</span><span class="text-blue-400 text-xs">8,900</span></div>
                <div class="flex items-center p-2 rounded-lg bg-blue-900/20 border border-blue-500/30"><span class="w-6 text-white font-bold">142</span><span class="flex-1 text-white text-sm font-bold">YOU</span><span class="text-yellow-400 text-xs" id="lb-score">0</span></div>
            </div>
        </div>
        <div class="footer-nav">
            <div class="nav-item active"><i class="fa-solid fa-trophy"></i>Leagues</div>
            <div class="nav-item" onclick="app.showScreen('screen-settings')"><i class="fa-solid fa-gear"></i>Config</div>
            <div class="nav-item" onclick="app.showScreen('screen-hub')"><div class="w-12 h-12 bg-gray-800 border border-white/10 rounded-full flex items-center justify-center -mt-6 text-gray-400"><i class="fa-solid fa-gamepad text-xl mb-0"></i></div></div>
            <div class="nav-item" onclick="app.showScreen('screen-rewards')"><i class="fa-solid fa-gem"></i>Rewards</div>
            <div class="nav-item" onclick="app.showScreen('screen-profile')"><i class="fa-solid fa-user"></i>Profile</div>
        </div>
    </div>

    <!-- ==================== SCREEN 8: PROFILE ==================== -->
    <div id="screen-profile" class="screen bg-[#050505]">
        <div class="absolute top-0 w-full h-48 bg-gradient-to-b from-blue-900/20 to-black"></div>
        <div class="relative z-10 px-6 pt-20 flex flex-col items-center">
            <div class="w-24 h-24 rounded-full p-[2px] bg-gradient-to-tr from-neon-blue to-neon-purple mb-4 shadow-2xl">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-full h-full rounded-full bg-black">
            </div>
            <h2 class="text-2xl font-bold text-white mb-1">PlayerOne</h2>
            <div class="text-[10px] text-blue-400 font-bold uppercase tracking-wider border border-blue-500/30 px-3 py-1 rounded-full bg-blue-500/10">Cadet Level 3</div>
        </div>
        <div class="px-6 mt-8 w-full">
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="flashlight-card p-4 text-center bg-white/5">
                    <div class="text-2xl font-bold text-yellow-400 mb-1" id="prof-gems">0</div>
                    <div class="text-[9px] text-gray-500 uppercase tracking-widest font-bold">Gems</div>
                </div>
                <div class="flashlight-card p-4 text-center bg-white/5">
                    <div class="text-2xl font-bold text-blue-400 mb-1" id="prof-high">0</div>
                    <div class="text-[9px] text-gray-500 uppercase tracking-widest font-bold">High Score</div>
                </div>
            </div>
            <button class="w-full py-4 text-red-500 text-xs font-bold border border-red-500/20 rounded-xl hover:bg-red-500/10 transition" onclick="app.resetData()">Reset Progress</button>
        </div>
        <div class="footer-nav">
            <div class="nav-item" onclick="app.showScreen('screen-leaderboard')"><i class="fa-solid fa-trophy"></i>Leagues</div>
            <div class="nav-item" onclick="app.showScreen('screen-settings')"><i class="fa-solid fa-gear"></i>Config</div>
            <div class="nav-item" onclick="app.showScreen('screen-hub')"><div class="w-12 h-12 bg-gray-800 border border-white/10 rounded-full flex items-center justify-center -mt-6 text-gray-400"><i class="fa-solid fa-gamepad text-xl mb-0"></i></div></div>
            <div class="nav-item" onclick="app.showScreen('screen-rewards')"><i class="fa-solid fa-gem"></i>Rewards</div>
            <div class="nav-item active"><i class="fa-solid fa-user"></i>Profile</div>
        </div>
    </div>

    <!-- ==================== SCREEN 9: SETTINGS ==================== -->
    <div id="screen-settings" class="screen bg-[#050505] p-6 pt-20">
        <div class="header-glass">
            <div class="flex items-center gap-2 text-gray-400 hover:text-white cursor-pointer" onclick="app.showScreen('screen-hub')">
                <i class="fa-solid fa-arrow-left"></i> <span class="text-sm font-bold">Back</span>
            </div>
        </div>
        <h2 class="text-2xl font-display font-bold text-white mb-8">Settings</h2>
        <div class="space-y-3">
            <div class="flashlight-card p-4 flex justify-between items-center bg-[#111]">
                <div><div class="text-green-400 font-bold text-sm">Cash Out</div><div class="text-[10px] text-gray-500">Withdraw winnings</div></div>
                <i class="fa-solid fa-chevron-right text-gray-600"></i>
            </div>
            <div class="flashlight-card p-4 flex justify-between items-center bg-[#111]">
                <div><div class="text-white font-bold text-sm">Sound</div><div class="text-[10px] text-gray-500">Volume</div></div>
                <i class="fa-solid fa-toggle-on text-blue-500 text-xl"></i>
            </div>
        </div>
        <div class="footer-nav">
            <div class="nav-item" onclick="app.showScreen('screen-leaderboard')"><i class="fa-solid fa-trophy"></i>Leagues</div>
            <div class="nav-item active"><i class="fa-solid fa-gear"></i>Config</div>
            <div class="nav-item" onclick="app.showScreen('screen-hub')"><div class="w-12 h-12 bg-gray-800 border border-white/10 rounded-full flex items-center justify-center -mt-6 text-gray-400"><i class="fa-solid fa-gamepad text-xl mb-0"></i></div></div>
            <div class="nav-item" onclick="app.showScreen('screen-rewards')"><i class="fa-solid fa-gem"></i>Rewards</div>
            <div class="nav-item" onclick="app.showScreen('screen-profile')"><i class="fa-solid fa-user"></i>Profile</div>
        </div>
    </div>

</div>

<!-- LOGIC -->
<script>
    // --- ANIMATIONS ---
    document.addEventListener('DOMContentLoaded', () => {
        const title = document.getElementById('brand-text');
        if(title) {
            const txt = title.innerText; title.innerHTML = '';
            txt.split('').forEach((c,i) => {
                const s = document.createElement('span'); s.innerText = c; s.className = 'clip-char'; s.style.animationDelay = `${i*0.1}s`; title.appendChild(s);
            });
        }
        document.addEventListener('mousemove', (e) => {
            document.querySelectorAll('.flashlight-card').forEach(c => {
                const r = c.getBoundingClientRect();
                c.style.setProperty('--mouse-x', `${e.clientX - r.left}px`);
                c.style.setProperty('--mouse-y', `${e.clientY - r.top}px`);
            });
        });
        
        // Carousel
        let slide = 0; const track = document.getElementById('hub-carousel');
        setInterval(() => {
            slide = (slide + 1) % 2;
            if(track) track.style.transform = `translateX(-${slide * 100}%)`;
        }, 4000);
    });

    // --- GAME ENGINE ---
    const GameEngine = {
        scene: null, camera: null, renderer: null, player: null, bullets: [], enemies: [],
        starField: null, animationId: null, lastTime: 0, score: 0, timeLeft: 60,
        isActive: false, targetX: 0, shotsFired: 0, shotsHit: 0, difficulty: 1,

        init: function() {
            const container = document.getElementById('game-canvas-container');
            const w = container.clientWidth; const h = container.clientHeight;
            this.scene = new THREE.Scene();
            this.scene.fog = new THREE.FogExp2(0x000000, 0.035);
            this.camera = new THREE.PerspectiveCamera(70, w/h, 0.1, 100);
            this.camera.position.set(0, 5, 10); this.camera.lookAt(0,0,-5);
            this.renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            this.renderer.setSize(w, h); this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            container.appendChild(this.renderer.domElement);
            
            const amb = new THREE.AmbientLight(0x404040, 2); this.scene.add(amb);
            const dir = new THREE.DirectionalLight(0xffffff, 1); dir.position.set(5,10,5); this.scene.add(dir);
            this.createStarfield();

            const canvas = this.renderer.domElement;
            const handleInput = (clientX) => {
                if(!this.isActive) return;
                const rect = container.getBoundingClientRect();
                const x = (clientX - rect.left) / rect.width;
                this.targetX = (x * 14) - 7;
            };
            canvas.addEventListener('touchmove', (e)=>{e.preventDefault(); handleInput(e.touches[0].clientX);}, {passive:false});
            canvas.addEventListener('mousemove', (e)=>{handleInput(e.clientX);});
            
            window.addEventListener('resize', ()=>{
                if(!this.camera) return;
                const cw = container.clientWidth; const ch = container.clientHeight;
                this.camera.aspect = cw/ch; this.camera.updateProjectionMatrix(); this.renderer.setSize(cw,ch);
            });
        },

        createStarfield: function() {
            const geo = new THREE.BufferGeometry(); const verts = [];
            for(let i=0; i<1000; i++) verts.push(THREE.MathUtils.randFloatSpread(60), THREE.MathUtils.randFloatSpread(60), THREE.MathUtils.randFloatSpread(60)-20);
            geo.setAttribute('position', new THREE.Float32BufferAttribute(verts, 3));
            this.starField = new THREE.Points(geo, new THREE.PointsMaterial({color:0xffffff, size:0.1}));
            this.scene.add(this.starField);
        },

        start: function() {
            this.isActive = true; this.score = 0; this.timeLeft = 60; this.difficulty = 1;
            this.shotsFired = 0; this.shotsHit = 0; this.bullets = []; this.enemies = [];
            
            // Clean Scene
            this.scene.children = this.scene.children.filter(c => c.isLight || c === this.starField);
            
            const pGeo = new THREE.ConeGeometry(0.5, 1.5, 4);
            const pMat = new THREE.MeshStandardMaterial({color: 0x00f3ff, emissive: 0x00f3ff, emissiveIntensity: 0.5});
            this.player = new THREE.Mesh(pGeo, pMat);
            this.player.rotation.x = -Math.PI/2; this.scene.add(this.player);

            document.getElementById('game-score').innerText = '0';
            document.getElementById('game-timer').innerText = '60';

            this.lastTime = performance.now();
            this.animate();

            this.spawnInt = setInterval(() => { if(this.isActive) this.spawnEnemy(); }, 1000);
            this.timerInt = setInterval(() => {
                if(this.isActive) {
                    this.timeLeft--;
                    document.getElementById('game-timer').innerText = this.timeLeft;
                    if(this.timeLeft % 10 === 0) {
                        clearInterval(this.spawnInt);
                        this.difficulty += 0.5;
                        this.spawnInt = setInterval(() => { if(this.isActive) this.spawnEnemy(); }, 1000/this.difficulty);
                    }
                    if(this.timeLeft <= 0) this.endGame();
                }
            }, 1000);
        },

        spawnEnemy: function() {
            const geo = new THREE.IcosahedronGeometry(Math.random()*0.5+0.5, 0);
            const color = Math.random()>0.5 ? 0xbc13fe : 0xffaa00;
            const enemy = new THREE.Mesh(geo, new THREE.MeshStandardMaterial({color:color, emissive:color, emissiveIntensity:0.6}));
            enemy.position.set((Math.random()*12)-6, 0, -20);
            enemy.userData = {speed: (Math.random()*10+10)*(1+(this.difficulty*0.1))};
            this.enemies.push(enemy); this.scene.add(enemy);
        },

        update: function(dt) {
            if(this.player) {
                this.player.position.x += (this.targetX - this.player.position.x) * 10 * dt;
                this.player.rotation.z = -(this.player.position.x - this.targetX) * 2;
            }
            if(performance.now() % 200 < 20) { // Shoot
                const b = new THREE.Mesh(new THREE.CylinderGeometry(0.1,0.1,0.5,8), new THREE.MeshBasicMaterial({color:0x00ffff}));
                b.position.copy(this.player.position); b.position.z-=1; b.rotation.x = -Math.PI/2;
                this.bullets.push(b); this.scene.add(b); this.shotsFired++;
            }

            // Move Bullets
            for(let i=this.bullets.length-1; i>=0; i--) {
                const b = this.bullets[i]; b.position.z -= 30*dt;
                if(b.position.z < -30) { this.scene.remove(b); this.bullets.splice(i,1); }
            }

            // Move Enemies
            for(let i=this.enemies.length-1; i>=0; i--) {
                const e = this.enemies[i]; e.position.z += e.userData.speed * dt;
                e.rotation.x += dt; e.rotation.y += dt;
                
                if(this.player && e.position.distanceTo(this.player.position) < 1.5) { this.endGame(); return; }
                if(e.position.z > 5) { this.scene.remove(e); this.enemies.splice(i,1); }
            }

            // Collisions
            for(let bi=this.bullets.length-1; bi>=0; bi--) {
                let hit = false;
                for(let ei=this.enemies.length-1; ei>=0; ei--) {
                    if(this.bullets[bi].position.distanceTo(this.enemies[ei].position) < 1.2) {
                        this.scene.remove(this.enemies[ei]); this.enemies.splice(ei,1);
                        hit = true; this.score += 100; this.shotsHit++;
                        document.getElementById('game-score').innerText = this.score; break;
                    }
                }
                if(hit) { this.scene.remove(this.bullets[bi]); this.bullets.splice(bi,1); }
            }

            // Starfield
            if(this.starField) {
                const pos = this.starField.geometry.attributes.position.array;
                for(let i=1; i<pos.length; i+=3) {
                    pos[i+1] += 10*dt; if(pos[i+1]>20) pos[i+1] = -40;
                }
                this.starField.geometry.attributes.position.needsUpdate = true;
            }
        },

        animate: function() {
            if(!this.isActive) return;
            this.animationId = requestAnimationFrame(()=>this.animate());
            const now = performance.now(); const dt = Math.min((now-this.lastTime)/1000, 0.1); this.lastTime = now;
            this.update(dt); this.renderer.render(this.scene, this.camera);
        },

        endGame: function() {
            this.isActive = false; clearInterval(this.spawnInt); clearInterval(this.timerInt);
            cancelAnimationFrame(this.animationId);
            const acc = this.shotsFired > 0 ? Math.round((this.shotsHit/this.shotsFired)*100) : 0;
            app.handleGameOver(this.score, acc, this.shotsHit);
        }
    };

    // --- APP LOGIC ---
    const app = {
        state: { gems: 50, cash: 0, score: 0, high: 0, tutorial: false, lastType: 'practice' },
        
        init: function() {
            const s = localStorage.getItem('titanState');
            if(s) this.state = JSON.parse(s);
            this.updateUI();
            
            GameEngine.init(); // Setup Three.js
            
            if(!this.state.tutorial) setTimeout(()=>this.showScreen('screen-landing'), 2500); // Wait for splash
            else setTimeout(()=>this.showScreen('screen-hub'), 2500);
        },

        updateUI: function() {
            const els = {
                'hub-gems': this.state.gems, 'hub-cash': `$${this.state.cash.toFixed(2)}`,
                'prof-gems': this.state.gems, 'prof-high': this.state.high,
                'mm-gems': this.state.gems, 'lb-score': this.state.high, 'rew-cash': `$${this.state.cash.toFixed(2)}`
            };
            for(let k in els) { const e = document.getElementById(k); if(e) e.innerText = els[k]; }
            localStorage.setItem('titanState', JSON.stringify(this.state));
        },

        showScreen: function(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        },

        completeLanding: function() { this.showScreen('screen-tutorial'); },
        
        finishTutorial: function() {
            this.state.tutorial = true; this.updateUI(); this.showScreen('screen-hub');
        },

        openMatchmaking: function() { this.showScreen('screen-matchmaking'); },

        startMatch: function(type) {
            const costs = { 'practice':0, 'rookie':3, 'pro':6 };
            if(this.state.gems < costs[type]) return alert("Not enough gems!");
            
            this.state.gems -= costs[type];
            this.state.lastType = type;
            this.updateUI();

            document.getElementById('match-loader').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('match-loader').classList.add('hidden');
                this.showScreen('screen-game');
                document.getElementById('game-canvas-container').classList.add('active');
                document.getElementById('game-tutorial-overlay').classList.remove('hidden');
            }, 1500);
        },

        startGameLoop: function() {
            document.getElementById('game-tutorial-overlay').classList.add('hidden');
            GameEngine.start();
        },

        handleGameOver: function(score, acc, hits) {
            document.getElementById('game-canvas-container').classList.remove('active');
            this.showScreen('screen-results');
            
            let prize = 0; let win = false;
            // Mock Opponent Logic
            const oppScore = this.state.lastType === 'practice' ? score - 100 : score + Math.floor(Math.random()*1000 - 300);
            if(score > oppScore) {
                win = true;
                if(this.state.lastType === 'rookie') prize = 5;
                if(this.state.lastType === 'pro') prize = 10;
            }

            // Update Result UI
            document.getElementById('res-title').innerText = win ? "VICTORY" : "DEFEAT";
            document.getElementById('res-title').className = win ? "text-5xl font-display font-black mb-2 text-yellow-400 drop-shadow-2xl" : "text-5xl font-display font-black mb-2 text-red-500 drop-shadow-2xl";
            document.getElementById('res-score').innerText = score;
            document.getElementById('res-acc').innerText = acc + "%";
            document.getElementById('res-hits').innerText = hits;
            document.getElementById('res-gems').innerText = win ? `+${prize}` : "0";

            this.state.gems += prize;
            if(score > this.state.high) this.state.high = score;
            this.updateUI();
        },

        watchAd: function() {
            alert("Watching Ad... +5 Gems");
            this.state.gems += 5; this.updateUI();
        },
        
        claimGift: function() {
            const btn = document.getElementById('gift-status');
            if(btn.innerText !== 'Claimed') {
                this.state.gems += 20; this.state.cash += 1;
                btn.innerText = 'Claimed'; btn.className = 'text-[10px] text-gray-500 font-bold';
                this.updateUI();
            }
        },

        resetData: function() {
            localStorage.removeItem('titanState'); location.reload();
        }
    };

    // Start
    window.onload = () => app.init();

</script>
</body>
</html>